<launch>
  <node name="player" pkg="rosbag" type="play" output="screen" args="-r 1 --quiet /home/kiwi/begs/arche_day_2/flight1_2ms.bag"/>

    <node name="voxgraph_mapper" pkg="voxgraph" type="voxgraph_mapping_node" output="screen" args="-alsologtostderr" launch-prefix="valgrind">
      <rosparam>
        verbose: true
        debug: true
        submap_creation_interval: 10
        pointcloud_topic: "/penguin/os1_cloud_node/points"
        subscriber_queue_length: 10
        world_frame: "world"
        odom_frame: "odom"
        robot_frame: "imu"
        odom_frame_corrected: "odom_corrected"
        robot_frame_corrected: "imu_corrected"
        sensor_frame_corrected: "os1_corrected"
        # Tuned calibration (0.01 rad off - final error without odom constraints [-0.04, -0.03, 0.35])
        # For calibration according to TFs, see STIX launch file
        T_robot_sensor:
          - [0.9894415, -0.0202266,  0.1435150, -0.006]
          - [0.0196511,  0.9997922,  0.0054266, -0.011]
          - [-0.1435949, -0.0025490,  0.9896333, 0.133]
          - [0.0,        0.0,        0.0,       1.0]
        tsdf_integrator:
          tsdf_voxel_size: 0.20
          truncation_distance: 0.60
          max_ray_length_m: 20.0
          use_const_weight: true
          use_weight_dropoff: true
          use_sparsity_compensation_factor: true
          sparsity_compensation_factor: 20.0
          # integration_order_mode: "sorted"
        measurements:
          submap_registration:
            enabled: true
            sampling_ratio: 0.05
            registration_method: "explicit_to_implicit"
            information_matrix:
              x_x:     1.0
              y_y:     1.0
              z_z:     1.0
              yaw_yaw: 1.0
          odometry:
            enabled: true
            information_matrix:
              x_x:     1.0
              y_y:     1.0
              z_z:     2500.0
              yaw_yaw: 2500.0
          height:
            enabled: true
            information_zz: 2500.0
      </rosparam>
    </node>
</launch>
